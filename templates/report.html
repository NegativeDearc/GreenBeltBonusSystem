<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="Chrome=1,IE=Edge;IE=11;IE=10;IE=9"/>
    <title>Monthly Report</title>
</head>
<link rel="stylesheet" href="static/bootstrap.min.css">
<script src="static/jquery.min.js"></script>
<script src="static/bootstrap.min.js"></script>
<link rel="stylesheet" href="static/bootstrap-table-expandable.css">
<script src="static/bootstrap-table-expandable.js"></script>
<script src="static/jspdf.min.js"></script>
<script src="static/jspdf.plugin.autotable.js"></script>
<script src="static/FileSaver.min.js"></script>

<body>
<header class="navbar navbar-fixed-top" style="background-color: #122b40">
    <div class="container-fluid" style="margin-top: 10px">
        <div style="text-align: left;font-size: 22px;color: white">Monthly Report System</div>
        </form>
    </div>
</header>


<div class="container-fluid" style="margin-top: 60px">
    <div class="row">
        <form action="" method="post" class="form-group">
    <div class="form-group">
        <label for="due_time" class="col-sm-1 control-label" style="margin-top: 5px">Date From</label>
        <div class="col-sm-2">
            <input type="date" class="form-control" name="date_begin" required="required">
        </div>
    </div>
    <div class="form-group">
        <label for="due_time" class="col-sm-1 control-label" style="margin-top: 5px">Date End</label>
        <div class="col-sm-2">
            <input type="date" class="form-control" name="date_end" required="required">
        </div>
    </div>
    <div class="form-group">
        <div class="col-sm-1">
             <input type="submit" class="btn btn-default" name="submit" value="submit">
        </div>
    </div>
</form>
    </div>
</div>

<div class="container-fluid" style="padding-top: 40px">
{% if data %}
<div class="table-responsive">
<table class="table table-striped table-hover table-expandable" id="report">
<caption style="text-align: center;font-size: 20px">From {{ request.form.get('date_begin') }} to {{ request.form.get('date_end') }}</caption>
<thead>
    <tr>
        <th>Name</th>
        <!--k is table columns,people role-->
        {% for k in data.get(data.keys()[0]).keys() %}
        <th>{{ k }}</th>
        {% endfor %}
    </tr>
</thead>
<tbody>
    {% for x,m in data.items() %}
        <tr>
        <!--x is table index,people name-->
        <th>{{ x }}</th>
        {% for y in m.values() %}
            <td>{{ y }}</td>
        {% endfor %}
        </tr>
        <tr>
          <td colspan="7">
              {{ x }}'s project show below:
              <!--insert project names-->
              <ol>
                  {% for e in prj.get(x) %}
                  <li><a href="/api/project/?term={{ e }}">{{ e }}</a></li>
                  {% endfor %}
              </ol>
          </td>
        </tr>
    {% endfor %}
</tbody>
</table>
</div>

<div class="container-fluid">
    <div class="navbar">
        <form action="" class="form-horizontal">
            <input type="button" onclick="print()" class="btn btn-success navbar-right" value="print">
        </form>
    </div>
</div>
</div>
{% endif %}

<script>
    print = function(){
        var doc = new jsPDF('p', 'pt');
        doc.text("From {{ request.form.get('date_begin') }} to {{ request.form.get('date_end') }}", 40, 50);
        var res = doc.autoTableHtmlToJson(document.getElementById("report"));
        doc.autoTable(res.columns, res.data,{startY:60});
        doc.save('CTCLSS_monthly_report.pdf');
    };
</script>
</body>
</html>