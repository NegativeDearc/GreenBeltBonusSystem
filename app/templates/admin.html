<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="Chrome=1,IE=Edge;IE=11;IE=10;IE=9"/>
    <title>Maintain Your DataBase</title>
</head>
<link rel="stylesheet" href="static/bootstrap.min.css">
<link rel="stylesheet" href="static/jquery-ui.css">
<script src="static/jquery.min.js"></script>
<script src="static/jquery-ui.min.js"></script>
<script src="static/bootstrap.min.js"></script>

<style type="text/css">
    th {text-align: center;vertical-align: middle!important;}
    td {text-align: center;vertical-align: middle!important;}
    li,p,label {font-family:"Microsoft YaHei",微软雅黑,"MicrosoftJhengHei",华文细黑,STHeiti,MingLiu}
    .alert {text-align: center}
</style>

<body>
<nav class="navbar navbar-default navbar-fixed-top" style="background-color: #27AE60">
    <a href="" style="color: white;font-size:18px;padding: 14px" class="btn btn-disabled disabled">Admin Panel</a>||
    <a href="{{ url_for('index') }}" style="color: white;font-size:16px;padding: 14px" class="btn">Home</a>|
    <a href="{{ url_for('rules') }}" style="color: white;font-size:16px;padding: 14px" class="btn">Rules Editor</a>|
    <a href="{{ url_for('report') }}" style="color: white;font-size:16px;padding: 14px" class="btn">Report System</a>
</nav>

<div class="row" style="padding-left:20px;padding-right: 20px;margin-top: 85px">
    <div class="col-md-3">
        <div class="panel panel-default">
        <div class="panel-heading">使用前必读说明</div>
        <div class="panel-body">
            <div>
            <ol style="color:red">
                <li>所有字段都需要填写,否则无法提交</li>
                <li>数据填写有误?只需勾选UPDATE按钮</li>
                <li>文件依据:QW144-01-01,详情请参见黑带文档</li>
                <li>请注意区分大小写,数据库对大小写敏感</li>
                <li>请注意中文逗号和英文逗号,英文字段不允许出现中文逗号</li>
                <li>如果遭遇内部错误500,请联系管理员6573</li>
                <hr>
                <li>员工名单录入时请仔细确认信息,不提供更新机会</li>
                <li>如果存在相同工号,网页会提示500错误</li>
            </ol>
            </div>
        </div>
    </div>
        <div class="well">
            <form id="form1">
                <div class="alert alert-info"><p>员工工号人名维护</p></div>
                <div class="form-group">
                    <label for="">员工ID编号</label>
                    <input type="text" class="form-control" id="employee_id" placeholder="insert employee id"
                           required="required" pattern="[0-9]+">
                    <div><p></p></div>
                    <label for="">英文名称或拼音</label>
                    <input type="text" class="form-control" id="employee_name" placeholder="insert employee name"
                           required="required" pattern="[a-zA-Z\s]+">
                    <input type="submit" name="sub2" value="submit" class="btn btn-default"
                           style="margin-top: 10px" onclick="postdata()">
                    <input type="reset" style="display: none" id="reset">
                </div>
            </form>
        </div>
        {% for messages in get_flashed_messages() %}
            <div class="alert-warning">{{ message }}</div>
        {% endfor %}
    </div>

    <div class="col-md-9 well" style="padding-right: 10px">
    <form action="" method="post" class="form-horizontal" id="form_data">
    <input type="hidden" name="_crsf_token" value="{{ crsf_token() }}">
    <div class="form-group">
        <label for="use_type" class="col-sm-3 control-label"><p>勾选来修改已经提交的数据</p></label>
        <div class="col-sm-6">
            <!--if choose request.form get 'on'-->
            <input type="checkbox" class="btn btn-success" name="update">
        </div>
    </div>
    <hr>

    <div class="form-group">
        <label for="use_type" class="col-sm-2 control-label"><p>可拓展性</p></label>
        <div class="col-sm-2">
            <!--if choose request.form get 'on'-->
            <select class="btn btn-success" name="duplicability" id="selection1">
                <option value="{{ data.duplicability.level3 }}">{{ data.duplicability.level3 }}(>2 Workshop)</option>
                <option value="{{ data.duplicability.level2 }}">{{ data.duplicability.level2 }}(1~2 Workshop)</option>
                <option value="{{ data.duplicability.level1 }}">{{ data.duplicability.level1 }}(Only Own Dept.)</option>
            </select>
        </div>

        <label for="" class="col-sm-2 control-label"><p>资源利用</p></label>
        <div class="col-sm-2">
            <select name="resource_usage" id="selection2" class="btn btn-success">
                <option value="{{ data.resource_usage.level3 }}">{{ data.resource_usage.level3 }}(External Resource of Company Usage)</option>
                <option value="{{ data.resource_usage.level2 }}">{{ data.resource_usage.level2 }} (Internal Resource of Company Usage)</option>
                <option value="{{ data.resource_usage.level1 }}">{{ data.resource_usage.level1 }} (Only Own Dept. Resource Usage)</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="" class="col-sm-2 control-label"><p>结案时长</p></label>
        <div class="col-sm-2">
            <!--if choose request.form get 'on'-->
            <select class="btn btn-success" name="implement_period" id="selection3">
                <option value="{{ data.implement_period.level3 }}">{{ data.implement_period.level3 }}(< 1 Month)</option>
                <option value="{{ data.implement_period.level2 }}">{{ data.implement_period.level2 }}(1~3 Month)</option>
                <option value="{{ data.implement_period.level1}}">{{ data.implement_period.level1 }}(> 3 Month)</option>
            </select>
        </div>

        <label for="" class="col-sm-2 control-label">
            <abbr title=" S(Safety)、Q(Quality)、C(Cost)、D(Delivery)、M(Morale)"><p>KPI等级</p></abbr>
        </label>
        <div class="col-sm-2">
            <select name="kpi_impact" id="selection4" class="btn btn-success">
                <option value="{{ data.kpi_impact.level3 }}">{{ data.kpi_impact.level3 }}(>= 3 Items)</option>
                <option value="{{ data.kpi_impact.level2 }}">{{ data.kpi_impact.level2 }}(2 Items)</option>
                <option value="{{ data.kpi_impact.level1 }}">{{ data.kpi_impact.level1 }} (Only 1 Item)</option>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label for="" class="col-sm-2 control-label">
            <abbr title="每千美元转换成1积分"><p>预估的成本节约</p></abbr>
        </label>
        <div class="col-sm-2">
            <input type="text" class="form-control" name="cost_saving"
                   required="required" placeholder="1000.2">
        </div>
    </div>
    <hr>
    <div class="form-group">
        <label for="proj_type" class="col-sm-2 control-label"><p>项目等级</p></label>
        <div class="col-sm-2">
            <select id="s1" class="btn btn-success" name="s1">
                <option value="S">S</option>
                <option value="P">P</option>
                <option value="K">K</option>
                <option value="G">G</option>
                <option value="B">B</option>
            </select>
        </div>
        <label for="" class="col-sm-2 control-label"><p>定向奖励积分</p></label>
        <div class="col-sm-2">
            <input type="number" min="0"  class="form-control" name="targeted_incentive_score">
        </div>
    </div>

    <div class="form-group">
        <label for="proj_num" class="col-sm-2 control-label"><p>项目编号</p></label>
        <div class="col-sm-2">
            <input type="text" class="form-control" placeholder="CKT1600X" name="project_num" required="required">
        </div>
        <label for="proj_name" class="col-sm-2 control-label"><p>项目描述</p></label>
        <div class="col-sm-4">
            <input type="text" class="form-control" placeholder="Title of your Project" name="project_name" required="required">
        </div>
    </div>
    <!--xx-->
    <div class="form-group">
        <label for="due_time" class="col-sm-2 control-label"><p>结案日期</p></label>
        <div class="col-sm-4">
            <input type="date" class="form-control" name="due_time" required="required">
        </div>
    </div>

    <hr>
    <div class="form-group">
        <label for="inintialor" class="col-sm-2 control-label"><p>项目发起人</p></label>
        <div class="col-sm-3">
            <input id="au2" type="text" class="form-control" name="inintialor" required="required" placeholder="ZHANG SAN">
        </div>
        <label for="leader" class="col-sm-2 control-label"><p>项目领导</p></label>
        <div class="col-sm-3">
            <input id="au2" type="text" class="form-control" name="leader" required="required" placeholder="ZHANG SAN">
        </div>
    </div>

    <div class="form-group">
        <label for="major_member" class="col-sm-2 control-label"><p>主要成员</p></label>
        <div class="col-sm-6">
            <input id="au" type="text" class="form-control" name="major_member" required="required" placeholder="LEON WANG,JUSTIN WAN" pattern="^[()0-9,a-zA-z\s]*[a-zA-Z]$">
        </div>
    </div>

    <div class="form-group">
        <label for="minior_member" class="col-sm-2 control-label"><p>次要成员</p></label>
        <div class="col-sm-6">
            <input id="au" type="text" class="form-control" name="minior_member" required="required" placeholder="KEVIN SONG,DAMON CHEN" pattern="^[()0-9,a-zA-z\s]*[a-zA-Z]$">
        </div>
    </div>

    <div class="form-group">
        <label for="frozen_member" class="col-sm-2 control-label"><p>积分冻结成员</p></label>
        <div class="col-sm-6">
            <input id="au" type="text" class="form-control" name="frozen_member" required="required" placeholder="" pattern="^[()0-9,a-zA-z\s]*[a-zA-Z]$">
        </div>
    </div>

    <div class="form-group">
        <label for="submit" class="col-sm-2 control-label"><p>提交表单</p></label>
        <div class="col-sm-4">
             <input type="submit" class="btn btn-default" name="sub1" value="submit" onclick="return dataAlert()">
        </div>
    </div>
    </form>
    </div>
</div>

<hr>

{% if data_3_month %}
<div class="container-fluid">
    <div class="table-responsive">
        <table class="table table-hover table-striped">
            <caption style="text-align: center;font-size: 20px">Projets reaching 3 month check point</caption>
            <tr>
                <th>Action</th>
                <th>PROJECT_NUMBER</th>
                <th>PROJECT_NAME</th>
                <th>CHECK_POINT_3_MONTH</th>
                <th>LEADER</th>
                <th>GOLDEN_IDEA_SCORE</th>
                <th>PROJECT_SCORE</th>
                <th>TARGET_SCORE</th>
                <th>ACTIVE_SCORE</th>
            </tr>

            {% for rows in data_3_month %}
            <tr>
            <td>
                <form action="" method="post">
                    <input class="btn btn-success" type="submit" name="{{ rows[0] }}" value="RELEASE3" style="width: 100px">
                    <input class="btn btn-warning" type="submit" name="{{ rows[0] }}" value="CLOSE3" style="width: 100px">
                    <!--add another submit here-->
                </form>
            </td>
            {% for element in rows %}
                <td>{{ element }}</td>
            {% endfor %}
            </tr>
        {% endfor %}
        </table>
    </div>
</div>
{% endif %}

{% if data_6_month %}
<div class="container-fluid">
    <div class="table-responsive">
        <table class="table table-hover table-striped">
            <caption style="text-align: center;font-size: 20px">Projets reaching 6 month check point</caption>
            <tr>
                <th>Action</th>
                <th>PROJECT_NUMBER</th>
                <th>PROJECT_NAME</th>
                <th>CHECK_POINT_6_MONTH</th>
                <th>LEADER</th>
                <th>GOLDEN_IDEA_SCORE</th>
                <th>PROJECT_SCORE</th>
                <th>TARGET_SCORE</th>
                <th>ACTIVE_SCORE</th>
            </tr>

            {% for rows in data_6_month %}
            <tr>
            <td>
                <form action="" method="post">
                    <input class="btn btn-success" type="submit" name="{{ rows[0] }}" value="RELEASE6" style="width: 100px">
                    <input class="btn btn-warning" type="submit" name="{{ rows[0] }}" value="CLOSE6" style="width: 100px">
                </form>
            </td>
            {% for element in rows %}
                <td>{{ element }}</td>
            {% endfor %}
            </tr>
        {% endfor %}
        </table>
    </div>
</div>
{% endif %}

{% if not data_3_month and not data_6_month %}
    <div class="container-fluid">
    <div>All the project in the range of checkpoint(-2,+30) will be show here.</div>
    </div>
{% endif %}

</body>

<script>
    var $SCRIPT_ROOT = {{ request.script_root|tojson|safe }}
    $.ajax({
        type: 'POST',
        url: $SCRIPT_ROOT+ '/api/selector',
        data:JSON.stringify({'s1':jQuery("#s1 option:selected").val(),'s2':jQuery("#s2 option:selected").val()}),
        dataType: 'json'
        //contentType:
        });

    $(function() {
        function split(val) {
            return val.split(/,\s*/);
        }

        function extractLast(term) {
            return split(term).pop();
        }

        $("input#au").autocomplete({
            source: function (request, response) {
                //the GET method! use flask request.agrs.get('term')
                $.getJSON($SCRIPT_ROOT + "/api/user/",{term: extractLast( request.term )},response);
            },

            focus: function() {
              //
              return false;
            },

            select: function (event, ui) {
                var terms = split(this.value);
                // pop
                terms.pop();
                //
                terms.push(ui.item.value);
                // add place holder,add ',' & ''
                terms.push("");
                this.value = terms.join(", ");
                return false;
            }
        })
    });

    $("input#au2").autocomplete({
            source: function (request, response) {
                //the GET method! use flask request.agrs.get('term')
                $.getJSON($SCRIPT_ROOT + "/api/user/",{term: request.term},response);
            }
    });

    /*ajax无刷提交表单*/
    $(function(){
        $('form#form1').on('submit', function(e) {
          e.preventDefault();
          var id = $("#employee_id").val();
          var name = $("#employee_name").val();
          $.ajax({
            type: 'GET',
            url: $SCRIPT_ROOT + "/api/add_employee/",
            data: "id=" + id + "&name=" + name,
            success: function () {
              alert('用户名已经提交成功！');
              $("#reset").trigger("click");
            },
            error:function(xhr,status,statusText){
                alert('服务器没有接受您的提交\n' + '错误信息:'+ xhr.statusText);
                $("#reset").trigger("click");
            }
          });
        });
      });

    /*以下代码供/admin面板数据检查*/
    var form_data = function(){
            var input_Data = document.getElementsByTagName('input');
            var elements = new Array();
            for (var i = 0;i < input_Data.length; i++){
                elements.push(input_Data[i].value);
            }
            return elements
        };

    var select_data = function(){
            var select_Data = document.getElementsByTagName('select');
            var elements = new Array();
            for (var i = 0;i < select_Data.length; i++){
                index = select_Data[i].selectedIndex;
                elements.push(select_Data[i].options[index].value);
            }
            return elements
        };

    var dataAlert = function (){
        data = form_data();
        data2 = select_data();
        data_string = "***请检查输入!***\n"+
                "***可复制性***--->" + data2[0] + "\n" +
                "***资源利用***--->" + data2[1] + "\n" +
                "***实行周期***--->" + data2[2] + "\n" +
                "***KPI等级***---->" + data2[3] + "\n" +
                "***节约成本***--->" + data[6] + "$" + "\n" +
                "***项目类型***--->" + data2[4] + "\n" +
                "***定向奖励***--->" + data[7] + "\n" +
                "***项目编号***--->" + data[8] + "\n" +
                "***项目描述***--->" + data[9] + "\n" +
                "***结案日期***--->" + data[10] + "\n" +
                "**项目发起人**--->" + data[11] + "\n" +
                "**项目执行者**--->" + data[12] + "\n" +
                "***主要成员***--->" + data[13] + "\n" +
                "***次要成员***--->" + data[14] + "\n" +
                "**积分冻结人员**-->" + data[15] + "\n"
        if (confirm(data_string)){
            alert('点击确认提交!');
            return true;
        }
        else{
            alert('撤销提交,请检查数据!');
            return false;
        }
    };
</script>
</html>